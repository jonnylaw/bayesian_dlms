<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Correlated DLM</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>




<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}

.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Bayesian Inference for DLMs</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="model_building_simulation.html">Model Building</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Filtering
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="kalman_filter.html">Kalman Filter</a>
    </li>
    <li>
      <a href="particle_filter.html">Bootstrap Particle Filter</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Parameter Learning
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="gibbs_sampling.html">Gibbs Sampling</a>
    </li>
    <li>
      <a href="pmmh.html">PMMH</a>
    </li>
  </ul>
</li>
<li>
  <a href="forecasting.html">Forecasting</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="FirstOrderDlm.html">First Order DLM</a>
    </li>
    <li>
      <a href="second_order_dlm.html">Linear Growth DLM</a>
    </li>
    <li>
      <a href="seasonal_dlm.html">Seasonal Composed DLM</a>
    </li>
    <li>
      <a href="CorrelatedModel.html">Multivariate DLM</a>
    </li>
    <li>
      <a href="student_t_filtering.html">Student's t-distributed DLM</a>
    </li>
    <li>
      <a href="ar1.html">Autoregressive Model</a>
    </li>
    <li>
      <a href="spain_investment_data.html">Spain Investment Data</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Correlated DLM</h1>

</div>


<div id="multivariate-dlms" class="section level1">
<h1>Multivariate DLMs</h1>
<p>In order to model many related time series and perform forecasting jointly we can formulate a Dynamic Linear Model with an observation <em>vector</em> containing values from the related time series at each timestep. To induce correlation in the model, the State evolution matrix, <span class="math inline">\(W\)</span>, is allowed to be full-rank. This can be learned from the data.</p>
<p><span class="math display">\[\begin{align}
\textbf{Y}_t &amp;= F_t x_t + \textbf{v}_t, \quad v_t \sim \textrm{MVN}(0, V), \\
X_t &amp;= G_t x_{t-1} + w_t, \quad w_t \sim \textrm{MVN}(0, W).
\end{align}\]</span></p>
<p>The observation at each time point consists of <span class="math inline">\(n\)</span> related time series, <span class="math inline">\(\textbf{Y}_t = (y_{1,t},\dots,y_{n,t})\)</span>.</p>
<div id="example" class="section level2">
<h2>Example</h2>
<p>To illustrate the combination of single models into a combined model, we consider the “outer sum” of two models. The first model is a first order polynomial model, the second model in the composition is a linear trend. The first model is given by:</p>
<p><span class="math display">\[\begin{align}
Y_t &amp;= x_t + v_t, \quad v_t \sim \textrm{MVN}(0, V), \\
X_t &amp;= x_{t-1} + w_t, \quad w_t \sim \textrm{MVN}(0, W), \\
X_0 &amp;\sim \textrm{MVN}(m_0, C_0).
\end{align}\]</span></p>
<p>Where the state, <span class="math inline">\(x_t\)</span> is univarate an evolves according to a random walk. The second model is given by:</p>
<p><span class="math display">\[\begin{align}
Y_t &amp;= F \textbf{x}_t + \textbf{v}_t, \quad v_t \sim \textrm{MVN}(0, V), \\
\textbf{X}_t &amp;= G \textbf{x}_{t-1} + w_t, \quad w_t \sim \textrm{MVN}(0, W), \\
\textbf{X}_0 &amp;\sim \textrm{MVN}(m_0, C_0).
\end{align}\]</span></p>
<p>The state is two dimensional, as such the system noise matrix <span class="math inline">\(W\)</span> is a <span class="math inline">\(2 \times 2\)</span> matrix. The observation matrix does not depend on time and is given by, <span class="math inline">\(F = (1 \quad 0)\)</span> and the system evolution matrix is:</p>
<p><span class="math display">\[G = \begin{pmatrix} 
1 &amp; 1 \\
0 &amp; 1
\end{pmatrix}.\]</span></p>
<p>The two DLMs above can be composed using an outer sum to model two time series which are thought to be related. The observation matrices are block-concatenated so that the composed model has as the observation matrix:</p>
<p><span class="math display">\[F = \begin{pmatrix} 
1 &amp; 0 \\
0 &amp; 1 \\
0 &amp; 0
\end{pmatrix}\]</span></p>
<p>The system evolution matrices of each model in the composition are block-concatenated so that the system matrix of the composed model is:</p>
<p><span class="math display">\[G = \begin{pmatrix} 
1 &amp; 0 &amp; 0 \\
0 &amp; 1 &amp; 1 \\
0 &amp; 0 &amp; 1
\end{pmatrix}.\]</span></p>
<p>In order to compose these two models in the Scala package, we first define the two models:</p>
<pre class="tut:silent"><code>import dlm.model._

val mod1 = Dlm.polynomial(1)
val mod2 = Dlm.polynomial(2)</code></pre>
<p>The models can now be composed using the outer sum function:</p>
<pre class="tut:silent"><code>import breeze.linalg.{diag, DenseMatrix, DenseVector}

val composedModel = mod1 |*| mod2

val p = Dlm.Parameters(
  v = diag(DenseVector(1.0, 2.0)), 
  w = diag(DenseVector(2.0, 3.0, 1.0)),
  m0 = DenseVector.zeros[Double](3), 
  c0 = DenseMatrix.eye[Double](3)
)</code></pre>
<p>Then we can simulate observations from the <code>composedModel</code>:</p>
<pre class="tut:silent"><code>val sims = Dlm.simulateRegular(0, composedModel, p, 1.0).
  steps.
  take(1000).
  toVector</code></pre>
<p>The figure below shows a simulation from this composed model:</p>
<p><img src="CorrelatedModel_files/figure-html/correlated-simulated-1.png" width="672" /></p>
</div>
</div>
<div id="example-2" class="section level1">
<h1>Example 2</h1>
<p>For simplicity of exposition we consider the outer sum of two first order DLMs. given by the following equation:</p>
<p><span class="math display">\[\begin{align*}
\begin{pmatrix}y_{1,t} \\ y_{2,t}\end{pmatrix} &amp;= \begin{pmatrix}1 &amp; 0 \\ 0 &amp; 1\end{pmatrix}\begin{pmatrix}x_{1,t} \\ x_{2,t}\end{pmatrix} + \begin{pmatrix}v_{1,t} \\ v_{2,t} \end{pmatrix}, \qquad \textbf{v} \sim \textrm{MVN}\left(0, \begin{pmatrix}V_1 &amp; 0 \\ 0 &amp; V_2\end{pmatrix}\right), \\
\begin{pmatrix}x_{1,t} \\ x_{2,t} \end{pmatrix} &amp;= \begin{pmatrix}1 &amp; 0 \\ 0 &amp; 1\end{pmatrix} \begin{pmatrix}x_{1,t-1} \\ x_{2,t-1} \end{pmatrix} + \begin{pmatrix} w_1 \\ w_2 \end{pmatrix}, \qquad \textbf{v} \sim \textrm{MVN}\left(0, \begin{pmatrix}W_1 &amp; W_2 \\ W_4 &amp; W_4\end{pmatrix}\right), \\
\textbf{x}_0 &amp;\sim \textrm{MVN}(m_0, C_0).
\end{align*}\]</span></p>
<p>A simulation from this model is presented in the figure below:</p>
<p><img src="CorrelatedModel_files/figure-html/simple-correlated-simulated-1.png" width="672" /></p>
</div>
<div id="kalman-filtering" class="section level1">
<h1>Kalman Filtering</h1>
<p>Given that we have simulated the model, we can perform the Kalman filter to determine the filtering distribution of the latent state using the true value of the parameters. The figure below shows the filtering distribution with 90% probability intervals for time <span class="math inline">\(t = 200, \dots , 300\)</span>.</p>
<p><img src="CorrelatedModel_files/figure-html/filter-correlated-1.png" width="672" /></p>
<div id="parameter-learning" class="section level2">
<h2>Parameter Learning</h2>
<p>The unkown parameters of the model are the system noise matrix, <span class="math inline">\(W\)</span> and the observation noise matrix, <span class="math inline">\(V\)</span>. The observation noise matrix is assumed to be diagonal, meaning the measurement noise of each process is considered to be independent. We can use Gibbs Sampling to determine the values of <span class="math inline">\(W\)</span> and <span class="math inline">\(V\)</span> as expanded upon in the section on <a href="gibbs_sampling.html">Gibbs Sampling</a>.</p>
</div>
<div id="gibbs-sampling-correlated-model" class="section level2">
<h2>Gibbs Sampling Correlated Model</h2>
<p>In order to perform Gibbs Sampling for the Correlated model in Scala:</p>
<pre class="tut:silent"><code>val iters = GibbsSampling.sample(
    composedModel, 
    InverseGamma(4.0, 9.0), 
    InverseGamma(3.0, 3.0), 
    p, 
    sims.map(_._1))</code></pre>
<p><img src="CorrelatedModel_files/figure-html/correlated-v-diagnostics-1.png" width="672" /></p>
<p><img src="CorrelatedModel_files/figure-html/correlated-w-diagnostics-1.png" width="672" /></p>
</div>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
