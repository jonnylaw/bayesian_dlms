<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8" />
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />




<title>Second Order DLM</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/readable.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>


<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; background-color: #f8f8f8; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
pre, code { background-color: #f8f8f8; }
code > span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code > span.dt { color: #204a87; } /* DataType */
code > span.dv { color: #0000cf; } /* DecVal */
code > span.bn { color: #0000cf; } /* BaseN */
code > span.fl { color: #0000cf; } /* Float */
code > span.ch { color: #4e9a06; } /* Char */
code > span.st { color: #4e9a06; } /* String */
code > span.co { color: #8f5902; font-style: italic; } /* Comment */
code > span.ot { color: #8f5902; } /* Other */
code > span.al { color: #ef2929; } /* Alert */
code > span.fu { color: #000000; } /* Function */
code > span.er { color: #a40000; font-weight: bold; } /* Error */
code > span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #000000; } /* Constant */
code > span.sc { color: #000000; } /* SpecialChar */
code > span.vs { color: #4e9a06; } /* VerbatimString */
code > span.ss { color: #4e9a06; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #000000; } /* Variable */
code > span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code > span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code > span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code > span.ex { } /* Extension */
code > span.at { color: #c4a000; } /* Attribute */
code > span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code > span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>


<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>


</head>

<body>

<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
  height: auto;
}
.tabbed-pane {
  padding-top: 12px;
}
button.code-folding-btn:focus {
  outline: none;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 66px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 71px;
  margin-top: -71px;
}

.section h2 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h3 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h4 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h5 {
  padding-top: 71px;
  margin-top: -71px;
}
.section h6 {
  padding-top: 71px;
  margin-top: -71px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>


<div class="container-fluid main-container">

<!-- tabsets -->
<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});
</script>

<!-- code folding -->






<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Bayesian Inference for DLMs</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="model_building_simulation.html">Model Building</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Filtering
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="kalman_filter.html">Kalman Filter</a>
    </li>
    <li>
      <a href="particle_filter.html">Bootstrap Particle Filter</a>
    </li>
    <li>
      <a href="particle_gibbs.html">Particle Gibbs</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Parameter Learning
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="gibbs_sampling.html">Gibbs Sampling</a>
    </li>
    <li>
      <a href="pmmh.html">PMMH</a>
    </li>
  </ul>
</li>
<li>
  <a href="forecasting.html">Forecasting</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Examples
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="FirstOrderDlm.html">First Order DLM</a>
    </li>
    <li>
      <a href="second_order_dlm.html">Linear Growth DLM</a>
    </li>
    <li>
      <a href="seasonal_dlm.html">Seasonal Composed DLM</a>
    </li>
    <li>
      <a href="CorrelatedModel.html">Multivariate DLM</a>
    </li>
    <li>
      <a href="student_t_filtering.html">Student's t-distributed DLM</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Second Order DLM</h1>

</div>


<div id="simulate-data" class="section level1">
<h1>Simulate Data</h1>
<p>The data is simulated from a second order DLM:</p>
<p><span class="math display">\[\begin{align}
Y_t &amp;= F \textbf{x}_t + v_t, \quad v_t \sim \mathcal{N}(0, V), \\
\textbf{X}_t &amp;= G \textbf{x}_{t-1} + \textbf{w}_t, \quad w_t \sim \textrm{MVN}(0, W), \\
\textbf{X}_0 &amp;\sim \textrm{MVN}(m_0, C_0).
\end{align}\]</span></p>
<p>The state is two dimensional, as such the system noise matrix <span class="math inline">\(W\)</span> is a <span class="math inline">\(2 \times 2\)</span> matrix. The observation and system evolution matrices do not depend on time, the observation matrix is <span class="math inline">\(F = (1 \quad 0)\)</span> and the system evolution matrix is:</p>
<p><span class="math display">\[G = \begin{pmatrix} 
1 &amp; 1 \\
0 &amp; 1
\end{pmatrix}.\]</span></p>
<p>In order to examine the properties of this model, first we can simulate a time series of values from it:</p>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala">scala&gt; <span class="kw">import</span> dlm.<span class="fu">model</span>._
<span class="kw">import</span> dlm.<span class="fu">model</span>._

scala&gt; <span class="kw">import</span> breeze.<span class="fu">linalg</span>.{DenseMatrix, DenseVector, diag}
<span class="kw">import</span> breeze.<span class="fu">linalg</span>.{DenseMatrix, DenseVector, diag}

scala&gt; <span class="kw">val</span> mod = Dlm.<span class="fu">polynomial</span>(<span class="dv">2</span>)
mod: dlm.<span class="fu">model</span>.<span class="fu">Dlm</span>.<span class="fu">Model</span> = <span class="fu">Model</span>(&lt;function1&gt;,&lt;function1&gt;)

scala&gt;   <span class="kw">val</span> p = Dlm.<span class="fu">Parameters</span>(
     |     <span class="fu">DenseMatrix</span>(<span class="fl">3.0</span>),
     |     <span class="fu">diag</span>(<span class="fu">DenseVector</span>(<span class="fl">2.0</span>, <span class="fl">1.0</span>)),
     |     <span class="fu">DenseVector</span>(<span class="fl">0.0</span>, <span class="fl">0.0</span>), 
     |     <span class="fu">diag</span>(<span class="fu">DenseVector</span>(<span class="fl">100.0</span>, <span class="fl">100.0</span>))
     |   )
p: dlm.<span class="fu">model</span>.<span class="fu">Dlm</span>.<span class="fu">Parameters</span> =
<span class="fu">Parameters</span>(<span class="fl">3.0</span>  ,<span class="fl">2.0</span>  <span class="fl">0.0</span>
<span class="fl">0.0</span>  <span class="fl">1.0</span>  ,<span class="fu">DenseVector</span>(<span class="fl">0.0</span>, <span class="fl">0.0</span>),<span class="fl">100.0</span>  <span class="fl">0.0</span>
<span class="fl">0.0</span>    <span class="fl">100.0</span>  )

scala&gt; <span class="kw">val</span> data = Dlm.<span class="fu">simulateRegular</span>(<span class="dv">0</span>, mod, p).
     |   steps.
     |   <span class="fu">take</span>(<span class="dv">1000</span>).
     |   toArray
data: Array[(dlm.<span class="fu">model</span>.<span class="fu">Data</span>, breeze.<span class="fu">linalg</span>.<span class="fu">DenseVector</span>[Double])] = Array((<span class="fu">Data</span>(<span class="fl">1.0</span>,Some(<span class="fu">DenseVector</span>(<span class="fl">1.5679528817306643</span>))),<span class="fu">DenseVector</span>(<span class="fl">2.159289046155471</span>, -<span class="fl">0.7806615604419134</span>)), (<span class="fu">Data</span>(<span class="fl">2.0</span>,Some(<span class="fu">DenseVector</span>(<span class="fl">3.8528248660909834</span>))),<span class="fu">DenseVector</span>(<span class="fl">2.512782460180432</span>, -<span class="fl">0.6702244734028807</span>)), (<span class="fu">Data</span>(<span class="fl">3.0</span>,Some(<span class="fu">DenseVector</span>(<span class="fl">5.289005461968545</span>))),<span class="fu">DenseVector</span>(<span class="fl">0.4834333309383738</span>, -<span class="fl">0.3799715257997729</span>)), (<span class="fu">Data</span>(<span class="fl">4.0</span>,Some(<span class="fu">DenseVector</span>(-<span class="fl">1.3289693953886035</span>))),<span class="fu">DenseVector</span>(-<span class="fl">1.617796806775834</span>, -<span class="fl">0.9719302340966052</span>)), (<span class="fu">Data</span>(<span class="fl">5.0</span>,Some(<span class="fu">DenseVector</span>(<span class="fl">0.1519957121782669</span>))),<span class="fu">DenseVector</span>(-<span class="fl">1.2732588732074404</span>, -<span class="fl">1.485000214258497</span>)), (<span class="fu">Data</span>(<span class="fl">6.0</span>,Some(<span class="fu">DenseVector</span>(-<span class="fl">1.6193510409618799</span>))),<span class="fu">DenseVector</span>(-<span class="fl">2.704973071625415</span>, -<span class="fl">1.7926304468512395</span>)), (<span class="fu">Data</span>(<span class="fl">7.0</span>,Some(<span class="fu">DenseVector</span>(-<span class="fl">8.851704914887845</span>))),<span class="fu">DenseVector</span>(-<span class="fl">5.504372993689264</span>, -<span class="fl">1.2834936759455795</span>)...</code></pre></div>
<div class="figure">
<img src="second_order_dlm_files/figure-html/second-order-simulated-1.png" alt="Simulated values from the Second Order DLM with parameters, $(V, W,     extbf{m}_0, C_0) = (3.0,    extrm{diag}(2.0, 1.0), (0.0, 0.0),  extrm{diag}(100.0, 100.0))$" width="672" />
<p class="caption">
Simulated values from the Second Order DLM with parameters, <span class="math inline">\((V, W, extbf{m}_0, C_0) = (3.0, extrm{diag}(2.0, 1.0), (0.0, 0.0), extrm{diag}(100.0, 100.0))\)</span>
</p>
</div>
</div>
<div id="filtered" class="section level1">
<h1>Filtered</h1>
<p>Kalman Filtering can be performed to learn the posterior distribution of the states, given the observations:</p>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala">scala&gt; <span class="kw">val</span> filtered = KalmanFilter.<span class="fu">filter</span>(mod, data.<span class="fu">map</span>(_._<span class="dv">1</span>), p)
filtered: Array[dlm.<span class="fu">model</span>.<span class="fu">KalmanFilter</span>.<span class="fu">State</span>] =
Array(State(<span class="fl">0.0</span>,<span class="fu">DenseVector</span>(<span class="fl">0.0</span>, <span class="fl">0.0</span>),<span class="fl">100.0</span>  <span class="fl">0.0</span>
<span class="fl">0.0</span>    <span class="fl">100.0</span>  ,<span class="fu">DenseVector</span>(<span class="fl">0.0</span>, <span class="fl">0.0</span>),<span class="fl">200.0</span>  <span class="fl">100.0</span>
<span class="fl">100.0</span>  <span class="fl">100.0</span>  ,None,None,<span class="fl">0.0</span>), State(<span class="fl">1.0</span>,<span class="fu">DenseVector</span>(<span class="fl">1.5450072298028985</span>, <span class="fl">0.7648550642588606</span>),<span class="fl">2.9560975609756097</span>  <span class="fl">1.4634146341463414</span>
<span class="fl">1.4634146341463414</span>  <span class="fl">52.21951219512194</span>   ,<span class="fu">DenseVector</span>(<span class="fl">0.0</span>, <span class="fl">0.0</span>),<span class="fl">202.0</span>  <span class="fl">100.0</span>
<span class="fl">100.0</span>  <span class="fl">101.0</span>  ,Some(<span class="fu">DenseVector</span>(<span class="fl">0.0</span>)),Some(<span class="fl">205.0</span>  ),-<span class="fl">3.5864398062844316</span>), State(<span class="fl">2.0</span>,<span class="fu">DenseVector</span>(<span class="fl">3.7794697345357906</span>, <span class="fl">2.077494450868447</span>),<span class="fl">2.8573747680890538</span>  <span class="fl">2.552179962894248</span>
<span class="fl">2.5521799628942485</span>  <span class="fl">7.550015460729751</span>  ,<span class="fu">DenseVector</span>(<span class="fl">2.3098622940617592</span>, <span class="fl">0.7648550642588606</span>),<span class="fl">60.102439024390236</span>  <span class="fl">53.68292682926828</span>
<span class="fl">53.68292682926828</span>   <span class="fl">53.21951219512194</span>  ,Some(<span class="fu">DenseVector</span>(<span class="fl">2.3098622940617592</span>)),Some(<span class="fl">63.102439024390236</span>  ),-<span class="fl">6.596622087624362</span>), State(...</code></pre></div>
<div class="figure">
<img src="second_order_dlm_files/figure-html/filtering-1.png" alt="Filtered State of the second order model, with 90% probability intervals" width="672" />
<p class="caption">
Filtered State of the second order model, with 90% probability intervals
</p>
</div>
</div>
<div id="learn-parameters" class="section level1">
<h1>Learn Parameters</h1>
<p>The parameters can be learned using Gibbs sampling. The state evolution distribution and the observation distribution are Gaussian with unknown variance <span class="math inline">\(W\)</span> and <span class="math inline">\(V\)</span> respectively. The state is assumed to have a diagonal, <span class="math inline">\(2 \times 2\)</span> covariance matrix and hence the unknown variances are chosen to have Inverse Gamma priors. The Inverse Gamma distribution is conjugate to the Normal distribution with known mean and unknown variance. To perform gibbs sampling using the Bayesian DLMs package:</p>
<div class="sourceCode"><pre class="sourceCode scala"><code class="sourceCode scala">scala&gt; <span class="kw">val</span> iters = GibbsSampling.<span class="fu">sample</span>(
     |     mod, 
     |     <span class="fu">InverseGamma</span>(<span class="fl">4.0</span>, <span class="fl">9.0</span>), 
     |     <span class="fu">InverseGamma</span>(<span class="fl">5.0</span>, <span class="fl">8.0</span>), 
     |     p, 
     |     data.<span class="fu">map</span>(_._<span class="dv">1</span>))
iters: breeze.<span class="fu">stats</span>.<span class="fu">distributions</span>.<span class="fu">Process</span>[dlm.<span class="fu">model</span>.<span class="fu">GibbsSampling</span>.<span class="fu">State</span>] = breeze.<span class="fu">stats</span>.<span class="fu">distributions</span>.<span class="fu">MarkovChain</span>$$anon$<span class="dv">1</span>@726430aa</code></pre></div>
<pre><code>##        V               W1               W2        
##  Min.   :1.850   Min.   :0.7802   Min.   :0.7099  
##  1st Qu.:2.792   1st Qu.:1.5999   1st Qu.:1.0273  
##  Median :2.991   Median :1.9401   Median :1.1170  
##  Mean   :2.987   Mean   :1.9919   Mean   :1.1279  
##  3rd Qu.:3.186   3rd Qu.:2.3262   3rd Qu.:1.2179  
##  Max.   :4.153   Max.   :4.4945   Max.   :1.9773</code></pre>
<p><img src="second_order_dlm_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
</div>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
